{% comment %} Slim testimonials carousel for home/other pages {% endcomment %}
<section class="nb-tcarousel tone-pebble">
  <div class="nb-tcarousel__head">
    <h2 class="nb-h3">{{ section.settings.heading }}</h2>
    <a class="nb-cta nb-cta--sm" href="{{ section.settings.cta_link }}">{{ section.settings.cta_label }}</a>
  </div>

  <div class="nb-tcarousel__track" data-track>
    {%- for block in section.blocks limit: section.settings.limit -%}
      <div class="nb-tcarousel__slide">
        {% render 'nb-testimonial-card',
          quote: block.settings.quote,
          name:  block.settings.name,
          title: block.settings.title,
          location: block.settings.location,
          avatar: block.settings.avatar,
          tags: block.settings.tags %}
      </div>
    {%- endfor -%}
  </div>

  <div class="nb-tcarousel__nav">
    <button class="nb-tcarousel__btn" type="button" data-dir="-1" aria-label="Previous">‹</button>
    <button class="nb-tcarousel__btn" type="button" data-dir="1" aria-label="Next">›</button>
  </div>
</section>

{% javascript %}
(() => {
  const root  = document.currentScript.closest('.nb-tcarousel');
  if (!root) return;

  // read-more inside slides (same enhancer as page)
  root.querySelectorAll('.nb-tcard').forEach(card => {
    const q = card.querySelector('[data-q]');
    const b = card.querySelector('[data-more]');
    if (!q || !b) return;
    if (q.scrollHeight > q.offsetHeight + 4) b.hidden = false;
    b.addEventListener('click', () => {
      card.classList.toggle('is-open');
      b.textContent = card.classList.contains('is-open') ? 'Show less' : 'Read full';
    });
  });

  // simple snap carousel
  const track = root.querySelector('[data-track]');
  const btns  = root.querySelectorAll('[data-dir]');
  if (!track) return;

  btns.forEach(btn => {
    btn.addEventListener('click', () => {
      const dir = Number(btn.dataset.dir || 1);
      const slide = track.querySelector('.nb-tcarousel__slide');
      const step = slide ? slide.clientWidth + 16 : track.clientWidth * 0.9;
      track.scrollBy({ left: dir * step, behavior: 'smooth' });
    });
  });
})();
{% endjavascript %}

{% stylesheet %}
.nb-tcarousel{ --t-gap: clamp(14px,2.2vw,20px); }
.nb-tcarousel__head{
  display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;
}
.nb-tcarousel__track{
  display:grid; grid-auto-flow:column; grid-auto-columns:minmax(min(320px, 33%), 1fr);
  gap:var(--t-gap); overflow:auto; scroll-snap-type:x mandatory; padding-bottom:4px; scrollbar-width:none;
}
.nb-tcarousel__track::-webkit-scrollbar{ display:none; }
.nb-tcarousel__slide{ scroll-snap-align:start; }
.nb-tcarousel__nav{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
.nb-tcarousel__btn{
  width:36px; height:36px; border-radius:999px; border:1px solid #e9eeed; background:#fff; cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,.05);
}
.nb-tcarousel__btn:hover{ box-shadow:0 10px 18px rgba(0,0,0,.07); }
{% endstylesheet %}

{% schema %}
{
  "name": "Testimonials slider",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "What clients say" },
    { "type": "range", "id": "limit", "label": "Cards to show", "min": 1, "max": 12, "step": 1, "default": 3 },
    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "View all" },
    { "type": "url", "id": "cta_link", "label": "CTA link", "default": "shopify://pages/testimonial" }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "textarea", "id": "quote", "label": "Quote", "default": "“This work helped me get clear, make braver choices, and feel more alive in daily life.”" },
        { "type": "text", "id": "name", "label": "Name", "default": "Client name" },
        { "type": "text", "id": "title", "label": "Title / descriptor", "default": "Founder" },
        { "type": "text", "id": "location", "label": "Location", "default": "London, UK" },
        { "type": "image_picker", "id": "avatar", "label": "Avatar (optional)" },
        { "type": "text", "id": "tags", "label": "Tags (optional)", "default": "-" }
      ]
    }
  ],
  "presets": [{ "name": "Testimonials slider" }]
}
{% endschema %}
