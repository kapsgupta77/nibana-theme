{% comment %} Homepage / inline slider of testimonials {% endcomment %}
<section class="nb-tslider tone-pebble">
  {%- liquid
    assign limit = section.settings.limit | default: 6
    assign heading = section.settings.heading | default: 'Our Testimonial'
    assign view_all = section.settings.view_all_link | default: '/pages/testimonial'
  -%}

  {%- if heading != blank -%}
  <header class="nb-tslider__head">
    <h2 class="nb-h3">{{ heading }}</h2>
  </header>
  {%- endif -%}

  <div class="nb-tslider__rail" data-rail>
    <button class="nb-tslider__nav is-prev" type="button" aria-label="Previous" data-prev>&larr;</button>

    <div class="nb-tslider__track" data-track>
      {%- assign mo = shop.metaobjects['nb_testimonial'] -%}
      {%- if mo and mo.values and mo.values.size > 0 -%}
        {%- for m in mo.values limit: limit -%}
          {%- assign q   = m.quote    | default: '' -%}
          {%- assign n   = m.name     | default: '' -%}
          {%- assign tt  = m.title    | default: '' -%}
          {%- assign loc = m.location | default: '' -%}
          {%- assign av  = m.avatar -%}
          <div class="nb-tslide">
            {% render 'nb-testimonial-card', card: { 'quote': q, 'name': n, 'title': tt, 'location': loc, 'avatar': av } %}
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>

    <button class="nb-tslider__nav is-next" type="button" aria-label="Next" data-next>&rarr;</button>
  </div>

  {%- if view_all != blank -%}
  <div class="nb-tslider__cta">
    <a class="nb-cta nb-cta--md" href="{{ view_all }}">View all</a>
  </div>
  {%- endif -%}
</section>

{% javascript %}
(() => {
  const root = document.currentScript.closest('.nb-tslider');
  if (!root) return;
  const track = root.querySelector('[data-track]');
  const prev  = root.querySelector('[data-prev]');
  const next  = root.querySelector('[data-next]');
  if (!track || !prev || !next) return;

  const step = () => Math.max(track.clientWidth * 0.85, 320);
  prev.addEventListener('click', () => track.scrollBy({ left: -step(), behavior:'smooth'}));
  next.addEventListener('click', () => track.scrollBy({ left:  step(), behavior:'smooth'}));
})();
{% endjavascript %}

{% stylesheet %}
.nb-tslider{ --t-accent: var(--nb-chocolate); --t-gap: 14px; }
.nb-tslider__head{ text-align:center; margin-bottom:10px; }
.nb-tslider__rail{ position:relative; }
.nb-tslider__track{
  display:grid;
  grid-auto-flow:column;
  grid-auto-columns:minmax(320px, 1fr);
  gap: var(--t-gap);
  overflow:auto; scroll-snap-type:x mandatory; padding: 6px 4px 8px;
  scrollbar-width:none;
}
.nb-tslider__track::-webkit-scrollbar{ display:none; }
.nb-tslide{ scroll-snap-align:start; }
.nb-tslider__nav{
  position:absolute; top:50%; transform:translateY(-50%);
  width:36px; height:36px; border-radius:999px; border:1px solid rgba(0,0,0,.1);
  background:#fff; box-shadow:0 8px 18px rgba(0,0,0,.06); cursor:pointer;
}
.nb-tslider__nav.is-prev{ left:-6px; }
.nb-tslider__nav.is-next{ right:-6px; }
.nb-tslider__cta{ text-align:center; margin-top:14px; }
{% endstylesheet %}

{% schema %}
{
  "name": "Testimonials slider",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Our clients say" },
    { "type": "range", "id": "limit", "label": "Max items", "min": 3, "max": 24, "step": 1, "default": 9 },
    { "type": "url", "id": "view_all_link", "label": "View all link", "default": "/pages/testimonial" }
  ],
  "presets": [{ "name": "Testimonials (slider)" }]
}
{% endschema %}
