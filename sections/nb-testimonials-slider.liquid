{% comment %}
  Nibana — Testimonials Slider (manual blocks)
  - Displays up to N testimonial cards in a horizontal scroll carousel
  - Heading on the left, CTA on the right (CTA URL is optional in schema; we fall back in Liquid)
  - Uses snippet 'nb-testimonial-card' to render each card
{% endcomment %}

<section class="nb-tcarousel tone-pebble">
  {% liquid
    assign heading   = section.settings.heading   | default: 'What clients say'
    assign limit     = section.settings.limit     | default: 3
    assign cta_label = section.settings.cta_label | default: 'View all'
    assign cta_link  = section.settings.cta_link  | default: '/pages/testimonial'
  %}

  <div class="nb-tcarousel__head">
    <h2 class="nb-h3">{{ heading }}</h2>
    <a class="nb-cta nb-cta--sm" href="{{ cta_link }}">{{ cta_label }}</a>
  </div>

  <div class="nb-tcarousel__track" role="list">
    {% for block in section.blocks limit: limit %}
      {% assign q   = block.settings.quote    | default: '' %}
      {% assign n   = block.settings.name     | default: '' %}
      {% assign tt  = block.settings.title    | default: '' %}
      {% assign loc = block.settings.location | default: '' %}
      {% assign av  = block.settings.avatar %}

      <article class="nb-tcarousel__slide" role="listitem">
        {% render 'nb-testimonial-card',
          card: { 'quote': q, 'name': n, 'title': tt, 'location': loc, 'avatar': av } %}
      </article>
    {% endfor %}
  </div>

  <nav class="nb-tcarousel__nav" aria-label="Carousel controls">
    <button class="nb-tcarousel__btn" data-prev aria-label="Previous">‹</button>
    <button class="nb-tcarousel__btn" data-next aria-label="Next">›</button>
  </nav>
</section>

{% javascript %}
(() => {
  const root  = document.currentScript.closest('.nb-tcarousel');
  if (!root) return;
  const track = root.querySelector('.nb-tcarousel__track');
  const prev  = root.querySelector('[data-prev]');
  const next  = root.querySelector('[data-next]');

  const step = () => Math.round(track.clientWidth * 0.9);

  prev && prev.addEventListener('click', () => {
    track.scrollBy({ left: -step(), behavior: 'smooth' });
  });
  next && next.addEventListener('click', () => {
    track.scrollBy({ left:  step(), behavior: 'smooth' });
  });
})();
{% endjavascript %}

{% stylesheet %}
.nb-tcarousel{ --t-gap: clamp(14px,2.2vw,20px); }
.nb-tcarousel__head{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; margin-bottom:12px;
}

/* Track */
.nb-tcarousel__track{
  display:grid;
  grid-auto-flow:column;
  grid-auto-columns:minmax(min(320px, 90vw), 33%);
  gap:var(--t-gap);
  overflow:auto;
  scroll-snap-type:x mandatory;
  padding-bottom:6px;
  scrollbar-width:none;
}
.nb-tcarousel__track::-webkit-scrollbar{ display:none; }
.nb-tcarousel__slide{ scroll-snap-align:start; }

/* Nav */
.nb-tcarousel__nav{
  display:flex; gap:8px; justify-content:flex-end; margin-top:10px;
}
.nb-tcarousel__btn{
  width:36px; height:36px; border-radius:999px; border:1px solid #e9eeee;
  background:#fff; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.05);
}
.nb-tcarousel__btn:hover{ box-shadow:0 10px 18px rgba(0,0,0,.07); }
{% endstylesheet %}

{% schema %}
{
  "name": "Testimonials slider",
  "settings": [
    { "type": "text",  "id": "heading",   "label": "Heading",      "default": "What clients say" },
    { "type": "range", "id": "limit",     "label": "Cards to show", "min": 1, "max": 12, "step": 1, "default": 3 },
    { "type": "text",  "id": "cta_label", "label": "CTA label",     "default": "View all" },
    { "type": "url",   "id": "cta_link",  "label": "CTA link" }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "textarea",     "id": "quote",    "label": "Quote",              "default": "“This work helped me get clear, make braver choices, and feel more alive in daily life.”" },
        { "type": "text",         "id": "name",     "label": "Name",               "default": "Client name" },
        { "type": "text",         "id": "title",    "label": "Title / descriptor", "default": "Founder" },
        { "type": "text",         "id": "location", "label": "Location",           "default": "London, UK" },
        { "type": "image_picker", "id": "avatar",   "label": "Avatar (optional)" },
        { "type": "text",         "id": "tags",     "label": "Tags (optional)",    "default": "-" }
      ]
    }
  ],
  "presets": [
    { "name": "Testimonials slider" }
  ]
}
{% endschema %}
