{% comment %}
  Coaching Service — metaobject-driven page section
  Expects a Page metafield: custom.coaching_service -> CoachingService entry
{% endcomment %}

{%- assign service = page.metafields.custom.coaching_service.value -%}
{%- if service == blank -%}
  <div class="page-width">
    <p>Missing coaching service data. Assign a “CoachingService” entry to this page’s metafield.</p>
  </div>
  {%- break -%}
{%- endif -%}

{%- comment %}
  Helpers
{%- endcomment %}
{%- assign cta_href = service.cta_link -%}
{%- if cta_href == blank -%}{% assign cta_href = '/pages/book-a-call' %}{% endif %}

{%- assign hero_title = service.hero_heading | default: service.title -%}
{%- assign hero_sub  = service.hero_subheading -%}
{%- assign hero_vid  = service.hero_video_url | strip -%}
{%- assign hero_img  = service.hero_image -%}

{%- comment %}
  Utility: render a bullet list from a multi-line text field.
  Strips common bullet chars and ignores blank lines.
{%- endcomment %}
{%- capture render_list -%}
  {%- assign raw = include.src | newline_to_br | split: '<br />' -%}
  <ul class="{{ include.class | default: '' }}">
    {%- for line in raw -%}
      {%- assign item = line | strip | remove: '•' | remove: '*' | remove: '-' | strip -%}
      {%- if item != '' -%}
        <li>{{ item }}</li>
      {%- endif -%}
    {%- endfor -%}
  </ul>
{%- endcapture -%}

<section class="nb-coaching">
  <div class="nb-hero page-width">
    <div class="nb-hero__copy">
      {% if hero_title %}<h1 class="nb-hero__title">{{ hero_title }}</h1>{% endif %}
      {% if hero_sub %}<p class="nb-hero__sub">{{ hero_sub }}</p>{% endif %}

      <a class="nb-btn nb-btn--cta" href="{{ cta_href }}" data-cta="service-hero">
        {{ service.cta_label | default: 'Book a free 20-min call' }}
      </a>
    </div>

    <div class="nb-hero__media">
      {% if hero_vid %}
        {% if hero_vid contains 'youtube' or hero_vid contains 'youtu.be' %}
          {%- assign y = hero_vid
            | replace: 'watch?v=', 'embed/'
            | replace: 'youtu.be/', 'www.youtube.com/embed/' -%}
          <div class="nb-embed">
            <iframe src="{{ y }}?rel=0&modestbranding=1"
                    title="Service video" allow="autoplay; encrypted-media; picture-in-picture"
                    allowfullscreen loading="lazy"></iframe>
          </div>
        {% elsif hero_vid contains 'vimeo' %}
          <div class="nb-embed">
            <iframe src="{{ hero_vid | replace: 'vimeo.com/', 'player.vimeo.com/video/' }}"
                    title="Service video" allow="autoplay; encrypted-media; picture-in-picture"
                    allowfullscreen loading="lazy"></iframe>
          </div>
        {% endif %}
      {% elsif hero_img != blank %}
        <img
          src="{{ hero_img | image_url: width: 1400 }}"
          srcset="
            {{ hero_img | image_url: width: 700  }} 700w,
            {{ hero_img | image_url: width: 1000 }} 1000w,
            {{ hero_img | image_url: width: 1400 }} 1400w
          "
          sizes="(max-width: 989px) 100vw, 640px"
          alt="{{ hero_title | escape }}"
          class="nb-hero__img"
          loading="eager" fetchpriority="high">
      {% else %}
        <div class="nb-hero__placeholder">
          <div class="nb-hero__blob"></div>
        </div>
      {% endif %}
    </div>
  </div>

  {%- comment %} Outcomes (cards) {%- endcomment %}
  {% if service.outcomes %}
  <div class="nb-tray page-width">
    <h2 class="nb-h2">What you’ll get</h2>
    <div class="nb-cards">
      {%- assign lines = service.outcomes | newline_to_br | split: '<br />' -%}
      {%- for line in lines -%}
        {%- assign item = line | strip | remove: '•' | remove: '*' | remove: '-' | strip -%}
        {%- if item != '' -%}
          <div class="nb-card">{{ item }}</div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
  {% endif %}

  {%- comment %} Is this for you? {%- endcomment %}
  {%- if service.is_for_you and service.is_for_you != blank -%}
<section class="nb-tray">
  <h2 class="nb-h2">Is this for you?</h2>

  {%- assign for_you_raw   = service.is_for_you | strip -%}
  {%- assign for_you_items = for_you_raw | newline_to_br | split: '<br />' -%}

  <ul class="nb-pills">
    {%- for i in for_you_items -%}
      {%- assign txt = i | strip | remove: '• ' | remove: '* ' -%}
      {%- if txt != '' -%}
        <li class="nb-pill">{{ txt }}</li>
      {%- endif -%}
    {%- endfor -%}
  </ul>
</section>
{%- endif -%}

  {%- comment %} How it works {%- endcomment %}
  {% if service.process_bodies %}
  <div class="nb-tray page-width">
    <h2 class="nb-h2">{{ service.process_titles | default: 'How it works' }}</h2>
    {%- assign steps = service.process_bodies | newline_to_br | split: '<br />' -%}
    <ol class="nb-steps">
      {%- for s in steps -%}
        {%- assign item = s | strip | remove: '•' | remove: '*' | remove: '-' | strip -%}
        {%- if item != '' -%}<li>{{ item }}</li>{%- endif -%}
      {%- endfor -%}
    </ol>
  </div>
  {% endif %}

  {%- comment %} Approach / method {%- endcomment %}
  {% if service.method_title or service.method_richtext %}
  <div class="nb-tray page-width">
    {% if service.method_title %}<h2 class="nb-h2">{{ service.method_title }}</h2>{% endif %}
    {% if service.method_richtext %}<div class="rte">{{ service.method_richtext }}</div>{% endif %}
  </div>
  {% endif %}

  {%- comment %} Myths / truths {%- endcomment %}
  {%- if (service.myths and service.myths != blank) or (service.truths and service.truths != blank) -%}
<section class="nb-tray">
  <div class="nb-grid-2">
    {%- if service.myths and service.myths != blank -%}
      {%- assign myths = service.myths | strip | newline_to_br | split: '<br />' -%}
      <div class="nb-card">
        <h3 class="nb-h3">Common myths</h3>
        <ul class="nb-list">
          {%- for m in myths -%}
            {%- assign t = m | strip | remove: '• ' | remove: '* ' -%}
            {%- if t != '' -%}<li>{{ t }}</li>{%- endif -%}
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}

    {%- if service.truths and service.truths != blank -%}
      {%- assign truths = service.truths | strip | newline_to_br | split: '<br />' -%}
      <div class="nb-card">
        <h3 class="nb-h3">What’s actually true</h3>
        <ul class="nb-list">
          {%- for t2 in truths -%}
            {%- assign t = t2 | strip | remove: '• ' | remove: '* ' -%}
            {%- if t != '' -%}<li>{{ t }}</li>{%- endif -%}
          {%- endfor -%}
        </ul>
      </div>
    {%- endif -%}
  </div>
</section>
{%- endif -%}
</section>

<style>
  .nb-coaching{ --ink:#223238; --teal:#0F5B59; --shell:#E6ECEA; --cta:#C86B2A; --cta-600:#9E4E19; }
  .page-width{ max-width:min(1160px,94vw); margin-inline:auto; }
  .nb-hero{ display:grid; grid-template-columns: 1.1fr .9fr; gap:28px; align-items:center; padding:28px 0; }
  @media (max-width: 989px){ .nb-hero{ grid-template-columns:1fr; } }
  .nb-hero__title{ font-size: clamp(28px,4.4vw,48px); line-height:1.1; margin:0 0 12px; }
  .nb-hero__sub{ font-size: clamp(16px,2.1vw,18px); opacity:.9; margin:0 0 18px; }
  .nb-hero__media .nb-embed{ position:relative; padding-top:56.25%; border-radius:14px; overflow:hidden; box-shadow:0 12px 30px rgba(0,0,0,.08); background:#000; }
  .nb-hero__media iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
  .nb-hero__img{ width:100%; height:auto; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,.08); }
  .nb-hero__placeholder{ height:320px; border-radius:14px; background:linear-gradient(140deg, var(--shell), #f4f6f5); position:relative; overflow:hidden; }
  .nb-hero__blob{ position:absolute; inset:auto -10% -40% -10%; height:140%; background:radial-gradient(ellipse at 30% 40%, rgba(15,91,89,.18), transparent 60%);}
  .nb-btn{ display:inline-flex; align-items:center; gap:.5rem; padding:12px 20px; border-radius:9999px; font-weight:600; text-decoration:none; }
  .nb-btn--cta{ background:var(--cta); color:#fff; border:2px solid var(--cta); box-shadow:0 10px 28px rgba(0,0,0,.06); }
  .nb-btn--cta:hover{ background:var(--cta-600); border-color:var(--cta-600); color:#fff; transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.10); }
  .nb-tray{ background:var(--shell); border-radius:18px; box-shadow:0 10px 28px rgba(0,0,0,.06); padding: clamp(18px,2vw,28px); margin: 10px auto 26px; }
  .nb-h2{ font-size: clamp(22px,3.2vw,32px); margin:0 0 12px; }
  .nb-h3{ font-size: clamp(18px,2.2vw,22px); margin:0 0 10px; }
  .nb-cards{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:14px; }
  @media (max-width: 680px){ .nb-cards{ grid-template-columns:1fr; } }
  .nb-card{ background:#fff; border-radius:14px; padding:16px 18px; box-shadow:0 12px 30px rgba(0,0,0,.05); }
  .nb-list{ padding-left:1.1rem; }
  .nb-list li{ margin:.35rem 0; }
  .nb-steps{ counter-reset:num; list-style: decimal inside; padding-left:1rem; }
  .nb-split{ display:grid; grid-template-columns:1fr 1fr; gap:18px; }
  @media (max-width: 820px){ .nb-split{ grid-template-columns:1fr; } }
</style>
