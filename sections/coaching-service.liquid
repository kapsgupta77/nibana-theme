{% comment %}
  Coaching Service template section (v2)
  - Reads the metaobject attached via page metafield: custom.coaching_service
  - Single hero CTA, brand-styled
  - Graceful hero placeholder when no media
  - Renders lists and longform if present
{% endcomment %}

{%- assign svc_ref = page.metafields.custom.coaching_service -%}
{%- assign service = nil -%}
{%- if svc_ref and svc_ref.value -%}{% assign service = svc_ref.value %}{%- endif -%}

<section id="coaching-service" class="nb-coach">
  {% if service %}
    {%- comment -%} ---------- Hero ---------- {%- endcomment -%}
    {%- assign cta_url = service.cta_link | default: '' -%}
    {%- if cta_url == blank -%}{% assign cta_url = '/pages/book-a-call' %}{%- endif -%}

    <header class="nb-hero">
      <div class="nb-hero__copy">
        <h1 class="nb-hero__title">
          {{ service.hero_heading | default: page.title | escape }}
        </h1>
        {% if service.hero_subheading != blank %}
          <p class="nb-hero__sub">{{ service.hero_subheading }}</p>
        {% endif %}
        <a href="{{ cta_url }}" class="nb-btn nb-btn--cta" data-cta="service-hero">
          {{ service.cta_label | default: 'Book a free 20-min call' }}
        </a>
      </div>

      <div class="nb-hero__media">
        {% if service.hero_video_url %}
          <div class="nb-embed">
            <iframe
              src="{{ service.hero_video_url | replace: 'watch?v=', 'embed/' }}"
              title="Intro video"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen></iframe>
          </div>
        {% elsif service.hero_image %}
          <img
            src="{{ service.hero_image | image_url: width: 1400 }}"
            srcset="
              {{ service.hero_image | image_url: width: 700 }} 700w,
              {{ service.hero_image | image_url: width: 1000 }} 1000w,
              {{ service.hero_image | image_url: width: 1400 }} 1400w
            "
            sizes="(max-width: 990px) 100vw, 640px"
            alt="{{ service.hero_heading | escape }}"
            class="nb-hero__img">
        {% else %}
          <div class="nb-hero__placeholder">
            <div class="nb-hero__ph-card">
              <p>Preview your hero image / video here.</p>
            </div>
          </div>
        {% endif %}
      </div>
    </header>

    {%- comment -%} ---------- Outcomes / Is this for you ---------- {%- endcomment -%}
    {% assign has_outcomes = service.outcomes and service.outcomes.size > 0 %}
    {% assign has_for_you = service.is_for_you and service.is_for_you.size > 0 %}
    {% if has_outcomes or has_for_you %}
      <section class="nb-panels">
        {% if has_outcomes %}
          <article class="nb-card">
            <h2 class="nb-card__title">What you’ll get</h2>
            <ul class="nb-list">
              {% for item in service.outcomes %}
                {% if item != blank %}<li>{{ item }}</li>{% endif %}
              {% endfor %}
            </ul>
          </article>
        {% endif %}
        {% if has_for_you %}
          <article class="nb-card">
            <h2 class="nb-card__title">Is this for you?</h2>
            <ul class="nb-list">
              {% for item in service.is_for_you %}
                {% if item != blank %}<li>{{ item }}</li>{% endif %}
              {% endfor %}
            </ul>
          </article>
        {% endif %}
      </section>
    {% endif %}

    {%- comment -%} ---------- Process steps ---------- {%- endcomment -%}
    {% assign has_steps = service.process_bodies and service.process_bodies.size > 0 %}
    {% if has_steps %}
      <section class="nb-proc">
        <h2 class="nb-proc__title">{{ service.process_titles | default: 'How it works' }}</h2>
        <ol class="nb-steps">
          {% for body in service.process_bodies %}
            {% if body != blank %}
              <li class="nb-step">{{ body }}</li>
            {% endif %}
          {% endfor %}
        </ol>
      </section>
    {% endif %}

    {%- comment -%} ---------- Method longform ---------- {%- endcomment -%}
    {% if service.method_title != blank or service.method_richtext != blank %}
      <section class="nb-method">
        {% if service.method_title != blank %}
          <h2 class="nb-method__title">{{ service.method_title }}</h2>
        {% endif %}
        {% if service.method_richtext != blank %}
          <div class="nb-method__body rte">{{ service.method_richtext }}</div>
        {% endif %}
      </section>
    {% endif %}

    {%- comment -%} ---------- Myths / Truths ---------- {%- endcomment -%}
    {% assign has_myths = service.myths and service.myths.size > 0 %}
    {% assign has_truths = service.truths and service.truths.size > 0 %}
    {% if has_myths or has_truths %}
      <section class="nb-myths">
        {% if has_myths %}
          <article class="nb-card">
            <h3 class="nb-card__title">Common myths</h3>
            <ul class="nb-list">
              {% for item in service.myths %}
                {% if item != blank %}<li>{{ item }}</li>{% endif %}
              {% endfor %}
            </ul>
          </article>
        {% endif %}
        {% if has_truths %}
          <article class="nb-card">
            <h3 class="nb-card__title">What’s actually true</h3>
            <ul class="nb-list">
              {% for item in service.truths %}
                {% if item != blank %}<li>{{ item }}</li>{% endif %}
              {% endfor %}
            </ul>
          </article>
        {% endif %}
      </section>
    {% endif %}

    {%- comment -%} ---------- FAQ (from Q/A lists) ---------- {%- endcomment -%}
    {% assign has_faq = service.faqs_q and service.faqs_a and service.faqs_q.size > 0 and service.faqs_a.size > 0 %}
    {% if has_faq %}
      <section class="nb-faq">
        <h2 class="nb-faq__title">Frequently asked questions</h2>
        <div class="nb-faq__list">
          {% for q in service.faqs_q %}
            {% assign a = service.faqs_a | at: forloop.index0 %}
            {% if q != blank and a != blank %}
              <details class="nb-faq__item">
                <summary class="nb-faq__q">{{ q }}</summary>
                <div class="nb-faq__a rte">{{ a }}</div>
              </details>
            {% endif %}
          {% endfor %}
        </div>
      </section>
    {% endif %}

  {% else %}
    <div class="page-width">
      <p>Attach a <em>CoachingService</em> entry to this page via the <strong>coaching_service</strong> metafield.</p>
    </div>
  {% endif %}
</section>

<style>
  /* ====== Nibana Coaching — scoped styles ====== */
  .nb-coach{ --nb-sage:#E6ECEA; --nb-ink:#223238; --nb-cta:#C86B2A; --nb-cta-600:#9E4E19; }
  .nb-coach .page-width{max-width:min(1160px,94vw);margin-inline:auto;}

  /* Hero */
  .nb-hero{display:grid;gap:24px;align-items:center;grid-template-columns:1.1fr .9fr;max-width:min(1160px,94vw);margin:32px auto;}
  .nb-hero__title{margin:0 0 8px;line-height:1.1;}
  .nb-hero__sub{margin:0 0 18px;font-size:1.08rem;opacity:.92}
  .nb-hero__media{width:100%}
  .nb-embed{position:relative;padding-top:56.25%;border-radius:16px;overflow:hidden;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .nb-embed iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
  .nb-hero__img{display:block;width:100%;height:auto;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .nb-hero__placeholder{background:var(--nb-sage);border-radius:16px;padding:24px;display:grid;place-items:center;height:320px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .nb-hero__ph-card{background:#fff;border-radius:14px;padding:18px 22px;box-shadow:0 8px 22px rgba(0,0,0,.06);color:#2d4046}

  .nb-btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:9999px;font-weight:700;line-height:1.1;text-decoration:none}
  .nb-btn--cta{background:var(--nb-cta);color:#fff;padding:12px 20px;border:2px solid var(--nb-cta);box-shadow:0 10px 28px rgba(0,0,0,.06);transition:background .15s, box-shadow .2s, transform .08s}
  .nb-btn--cta:hover{background:var(--nb-cta-600);border-color:var(--nb-cta-600);transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.10)}

  /* Panels */
  .nb-panels{max-width:min(1160px,94vw);margin:28px auto;display:grid;gap:18px;grid-template-columns:1fr 1fr}
  .nb-card{background:var(--nb-sage);border-radius:18px;padding:18px 22px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .nb-card__title{margin:0 0 8px}
  .nb-list{margin:0;padding-left:1.1rem}
  .nb-list li{margin:.35rem 0}

  /* Process */
  .nb-proc{max-width:min(1160px,94vw);margin:32px auto}
  .nb-steps{margin:0;padding-left:1.25rem}
  .nb-step{margin:.35rem 0}

  /* Method */
  .nb-method{max-width:min(1160px,94vw);margin:32px auto}
  .nb-method__title{margin:0 0 10px}

  /* FAQ */
  .nb-faq{max-width:min(1160px,94vw);margin:34px auto}
  .nb-faq__title{text-align:center;margin:0 0 14px}
  .nb-faq__list{display:grid;gap:12px}
  .nb-faq__item{background:#fff;border-radius:14px;border:1px solid rgba(0,0,0,.05);box-shadow:0 8px 22px rgba(0,0,0,.05);overflow:hidden}
  .nb-faq__q{cursor:pointer;list-style:none;padding:14px 18px;font-weight:650}
  .nb-faq__q::-webkit-details-marker{display:none}
  .nb-faq__a{padding:0 18px 16px;color:#2d4046}

  @media (max-width: 990px){
    .nb-hero{grid-template-columns:1fr}
    .nb-panels{grid-template-columns:1fr}
  }
</style>
