{%- comment -%}
  Nibana – Coaching Service (metaobject-driven)
  Update (2025-09-09):
  1) Colors use global tokens from assets/base.css (with safe fallbacks)
  2) Process rendered as a distinct timeline ("rail" layout)
  3) Method styles apply to any UL within .nb-method__body (not only h3+ul)
  4) Adds FAQ JSON-LD built from faqs_q/faqs_a (applies to any page using this section)
  5) Adds sticky mobile CTA
{%- endcomment -%}

{%- liquid
  assign cs_custom    = page.metafields.custom.coaching_service
  assign cs_canonical = page.metafields.coachingservice.coaching_service
  assign service_ref  = cs_custom | default: cs_canonical
  if service_ref and service_ref.value
    assign svc = service_ref.value
  endif

  assign hero_kicker     = svc.hero_kicker
  assign hero_heading    = svc.hero_heading | default: section.settings.fallback_title
  assign hero_subheading = svc.hero_subheading | default: section.settings.fallback_sub
  assign hero_image      = svc.hero_image
  assign hero_image_alt  = svc.hero_image_alt | default: hero_heading
  assign hero_video_url  = svc.hero_video_url

  assign cta_label = svc.cta_label | default: section.settings.cta_label
  assign cta_link  = svc.cta_link  | default: section.settings.cta_link

  assign outcomes   = svc.outcomes
  assign is_for_you = svc.is_for_you

  assign process_titles = svc.process_titles
  assign process_bodies = svc.process_bodies

  assign method_title    = svc.method_title
  assign method_richtext = svc.method_richtext

  assign myths  = svc.myths
  assign truths = svc.truths

  assign faqs_q = svc.faqs_q
  assign faqs_a = svc.faqs_a
-%}

<section class="nb-service" aria-label="Coaching service">
  <div class="page-width nb-hero">
    {%- if hero_kicker != blank -%}
      <p class="nb-kicker">{{ hero_kicker }}</p>
    {%- endif -%}

    <h1 class="nb-title">{{ hero_heading }}</h1>

    {%- if hero_subheading != blank -%}
      <div class="nb-sub rte">{{ hero_subheading }}</div>
    {%- endif -%}

    {%- if cta_label and cta_link -%}
      <div class="nb-cta-row">
        <a class="nb-cta" href="{{ cta_link }}" data-cta="primary-hero">{{ cta_label }}</a>
      </div>
    {%- endif -%}

    {%- if hero_video_url != blank -%}
      <div class="nb-media nb-media--video">
        <div class="nb-media__inner">
          <iframe
            src="{{ hero_video_url | replace: 'watch?v=', 'embed/' }}"
            title="{{ hero_image_alt | escape }}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen
          ></iframe>
        </div>
      </div>
    {%- elsif hero_image -%}
      <div class="nb-media nb-media--image">
        {{ hero_image | image_url: width: 1760 | image_tag:
          alt: hero_image_alt,
          widths: '640,880,1200,1440,1760',
          sizes: '(max-width: 780px) 92vw, 1100px',
          loading: 'eager'
        }}
      </div>
    {%- endif -%}
  </div>

  {%- comment -%} BENEFITS / OUTCOMES {%- endcomment -%}
  {%- if outcomes and outcomes.size > 0 -%}
  <div class="page-width nb-benefits">
    <h2 class="nb-h2">What you’ll get</h2>
    <ul class="nb-grid">
      {%- for item in outcomes -%}
        <li class="nb-card">
          {%- if item.title != blank -%}<h3>{{ item.title }}</h3>{%- endif -%}
          {%- if item.blurb != blank -%}<p>{{ item.blurb }}</p>{%- endif -%}
        </li>
      {%- endfor -%}
    </ul>
  </div>
  {%- endif -%}

  {%- comment -%} IS THIS FOR YOU? {%- endcomment -%}
  {%- if is_for_you and is_for_you.size > 0 -%}
  <div class="page-width nb-isforyou">
    <h2 class="nb-h2">Is this for you?</h2>
    <ul class="nb-bullets">
      {%- for line in is_for_you -%}
        {%- if line != blank -%}<li>{{ line }}</li>{%- endif -%}
      {%- endfor -%}
    </ul>
  </div>
  {%- endif -%}

  {%- comment -%} PROCESS – TIMELINE ("rail") {%- endcomment -%}
  {%- if process_titles and process_titles.size > 0 -%}
  <div class="page-width nb-process">
    <h2 class="nb-h2">The process</h2>
    <ol class="nb-steps" role="list">
      {%- for title in process_titles -%}
        {%- assign body = process_bodies[forloop.index0] -%}
        <li class="nb-step">
          <span class="nb-step__num" aria-hidden="true">{{ forloop.index }}</span>
          <div class="nb-step__body">
            <h3 class="nb-step__title">{{ title }}</h3>
            {%- if body != blank -%}<p class="nb-step__text">{{ body }}</p>{%- endif -%}
          </div>
        </li>
      {%- endfor -%}
    </ol>
  </div>
  {%- endif -%}

  {%- comment -%} METHOD – robust RTE styling for any UL inside body {%- endcomment -%}
  {%- if method_title != blank or method_richtext != blank -%}
  <div class="page-width nb-method">
    {%- if method_title != blank -%}<h2 class="nb-h2">{{ method_title }}</h2>{%- endif -%}
    <div class="nb-method__body rte">
      {{ method_richtext }}
    </div>
  </div>
  {%- endif -%}

  {%- comment -%} MYTHS vs TRUTH – paired by index {%- endcomment -%}
  {%- if myths and myths.size > 0 -%}
  <div class="page-width nb-myths">
    <h2 class="nb-h2">Myths vs Truth</h2>
    <ul class="nb-grid nb-two">
      {%- for myth in myths -%}
        {%- assign truth = truths[forloop.index0] -%}
        <li class="nb-card nb-card--myth">
          <h3>Myth</h3>
          <p>{{ myth }}</p>
        </li>
        <li class="nb-card nb-card--truth">
          <h3>Truth</h3>
          <p>{{ truth }}</p>
        </li>
      {%- endfor -%}
    </ul>
  </div>
  {%- endif -%}

  {%- comment -%} FAQ – accordion + JSON-LD {%- endcomment -%}
  {%- if faqs_q and faqs_q.size > 0 -%}
  <div class="page-width nb-faq">
    <h2 class="nb-h2">Frequently asked questions</h2>
    <div class="nb-accordion" data-single-open="true">
      {%- for q in faqs_q -%}
        {%- assign a = faqs_a[forloop.index0] -%}
        {%- if q != blank and a != blank -%}
        <details class="nb-qa">
          <summary class="nb-q">{{ q }}</summary>
          <div class="nb-a rte">{{ a }}</div>
        </details>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>

  {%- comment -%} JSON-LD: applies to all pages using this section {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {%- assign last_index = faqs_q.size | minus: 1 -%}
     
