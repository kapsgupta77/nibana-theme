{% comment %}
  Coaching Service — metaobject-driven page section
  Expects a Page metafield: custom.coaching_service -> CoachingService entry
{% endcomment %}

{%- assign service = page.metafields.custom.coaching_service.value -%}
{%- if service == blank -%}
  <div class="page-width" style="padding:20px 0">
    <p>Missing coaching service data. Assign a “CoachingService” entry to this page’s metafield (<em>custom.coaching_service</em>).</p>
  </div>
  {%- break -%}
{%- endif -%}

{%- comment %} Derive basics & sensible fallbacks {%- endcomment -%}
{%- assign cta_href   = service.cta_link -%}
{%- if cta_href == blank -%}{% assign cta_href = '/pages/book-a-call' %}{% endif %}
{%- assign hero_title = service.hero_heading | default: service.title -%}
{%- assign hero_sub   = service.hero_subheading -%}
{%- assign hero_vid   = service.hero_video_url | strip -%}
{%- assign hero_img   = service.hero_image -%}

<section class="nb-coaching">

  <!-- HERO -->
  <div class="nb-hero page-width">
    <div class="nb-hero__copy">
      {% if hero_title %}<h1 class="nb-hero__title">{{ hero_title }}</h1>{% endif %}
      {% if hero_sub %}<p class="nb-hero__sub">{{ hero_sub }}</p>{% endif %}

      <a class="nb-btn nb-btn--cta" href="{{ cta_href }}" data-cta="service-hero">
        {{ service.cta_label | default: 'Book a free 20-min call' }}
      </a>
    </div>

    <div class="nb-hero__media">
      {% if hero_vid %}
        {% if hero_vid contains 'youtube' or hero_vid contains 'youtu.be' %}
          {%- assign y = hero_vid
            | replace: 'watch?v=', 'embed/'
            | replace: 'youtu.be/', 'www.youtube.com/embed/' -%}
          <div class="nb-embed">
            <iframe src="{{ y }}?rel=0&modestbranding=1"
                    title="Service video" allow="autoplay; encrypted-media; picture-in-picture"
                    allowfullscreen loading="lazy"></iframe>
          </div>
        {% elsif hero_vid contains 'vimeo' %}
          <div class="nb-embed">
            <iframe src="{{ hero_vid | replace: 'vimeo.com/', 'player.vimeo.com/video/' }}"
                    title="Service video" allow="autoplay; encrypted-media; picture-in-picture"
                    allowfullscreen loading="lazy"></iframe>
          </div>
        {% endif %}
      {% elsif hero_img != blank %}
        <img
          src="{{ hero_img | image_url: width: 1400 }}"
          srcset="
            {{ hero_img | image_url: width: 700  }} 700w,
            {{ hero_img | image_url: width: 1000 }} 1000w,
            {{ hero_img | image_url: width: 1400 }} 1400w
          "
          sizes="(max-width: 989px) 100vw, 640px"
          alt="{{ hero_title | escape }}"
          class="nb-hero__img"
          loading="eager" fetchpriority="high">
      {% else %}
        <div class="nb-hero__placeholder">
          <div class="nb-hero__blob"></div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- OUTCOMES -->
  {% if service.outcomes %}
  <div class="nb-tray page-width">
    <h2 class="nb-h2">What you’ll get</h2>
    <div class="nb-cards">
      {%- assign lines = service.outcomes | newline_to_br | split: '<br />' -%}
      {%- for line in lines -%}
        {%- assign item = line | strip | remove: '•' | remove: '*' | remove: '-' | strip -%}
        {%- if item != '' -%}
          <div class="nb-card">{{ item }}</div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
  {% endif %}

  <!-- IS THIS FOR YOU -->
  {% if service.is_for_you and service.is_for_you != blank %}
  <div class="nb-tray page-width">
    <h2 class="nb-h2">Is this for you?</h2>
    {%- assign for_you_raw   = service.is_for_you | strip -%}
    {%- assign for_you_items = for_you_raw | newline_to_br | split: '<br />' -%}
    <ul class="nb-pills">
      {%- for i in for_you_items -%}
        {%- assign txt = i | strip | remove: '• ' | remove: '* ' | remove: '- ' -%}
        {%- if txt != '' -%}<li class="nb-pill">{{ txt }}</li>{%- endif -%}
      {%- endfor -%}
    </ul>
  </div>
  {% endif %}

  <!-- HOW IT WORKS -->
  {% if service.process_bodies %}
  <div class="nb-tray page-width">
    <h2 class="nb-h2">{{ service.process_titles | default: 'How it works' }}</h2>
    {%- assign steps = service.process_bodies | newline_to_br | split: '<br />' -%}
    <ol class="nb-steps">
      {%- for s in steps -%}
        {%- assign item = s | strip | remove: '•' | remove: '*' | remove: '-' | strip -%}
        {%- if item != '' -%}<li>{{ item }}</li>{%- endif -%}
      {%- endfor -%}
    </ol>
  </div>
  {% endif %}

  <!-- METHOD / APPROACH -->
  {% if service.method_title or service.method_richtext %}
  <div class="nb-tray page-width">
    {% if service.method_title %}<h2 class="nb-h2">{{ service.method_title }}</h2>{% endif %}
    {% if service.method_richtext %}<div class="rte">{{ service.method_richtext }}</div>{% endif %}
  </div>
  {% endif %}

  <!-- MYTHS / TRUTHS -->
  {%- assign myths_text  = service.myths  | default: '' | strip -%}
  {%- assign truths_text = service.truths | default: '' | strip -%}
  {% if myths_text != '' or truths_text != '' %}
  <div class="nb-tray page-width">
    <div class="nb-grid-2">
      {% if myths_text != '' %}
        {%- assign myths = myths_text | newline_to_br | split: '<br />' -%}
        <div class="nb-card">
          <h3 class="nb-h3">Common myths</h3>
          <ul class="nb-list">
            {%- for m in myths -%}
              {%- assign t = m | strip | remove: '• ' | remove: '* ' | remove: '- ' -%}
              {%- if t != '' -%}<li>{{ t }}</li>{%- endif -%}
            {%- endfor -%}
          </ul>
        </div>
      {% endif %}

      {% if truths_text != '' %}
        {%- assign truths = truths_text | newline_to_br | split: '<br />' -%}
        <div class="nb-card">
          <h3 class="nb-h3">What’s actually true</h3>
          <ul class="nb-list">
            {%- for t2 in truths -%}
              {%- assign t = t2 | strip | remove: '• ' | remove: '* ' | remove: '- ' -%}
              {%- if t != '' -%}<li>{{ t }}</li>{%- endif -%}
            {%- endfor -%}
          </ul>
        </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

</section>

<style>
  /* ===== NIBANA Coaching Service (lux finish) ===== */
  .nb-coaching{ --ink:#223238; --teal:#0F5B59; --shell:#E6ECEA; --cta:#C86B2A; --cta-600:#9E4E19; color:var(--ink); }
  .page-width{ max-width:min(1160px,94vw); margin-inline:auto; }

  /* Hero */
  .nb-hero{ display:grid; grid-template-columns: 1.12fr .88fr; gap:28px; align-items:center; padding:26px 0; }
  @media (max-width: 989px){ .nb-hero{ grid-template-columns:1fr; } }
  .nb-hero__title{ font-size: clamp(28px,4.4vw,48px); line-height:1.12; margin:0 0 12px; letter-spacing:.2px; }
  .nb-hero__sub{ font-size: clamp(16px,2.1vw,18px); opacity:.92; margin:0 0 18px; }
  .nb-hero__media .nb-embed{ position:relative; padding-top:56.25%; border-radius:14px; overflow:hidden; box-shadow:0 12px 30px rgba(0,0,0,.08); background:#000; }
  .nb-hero__media iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
  .nb-hero__img{ width:100%; height:auto; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,.08); }
  .nb-hero__placeholder{ height:320px; border-radius:14px; background:linear-gradient(140deg, var(--shell), #f4f6f5); position:relative; overflow:hidden; }
  .nb-hero__blob{ position:absolute; inset:auto -10% -40% -10%; height:140%; background:radial-gradient(ellipse at 30% 40%, rgba(15,91,89,.18), transparent 60%); }

  /* Buttons */
  .nb-btn{ display:inline-flex; align-items:center; gap:.5rem; padding:12px 20px; border-radius:9999px; font-weight:600; text-decoration:none; }
  .nb-btn--cta{ background:var(--cta); color:#fff; border:2px solid var(--cta); box-shadow:0 10px 28px rgba(0,0,0,.06); transition:transform .08s, box-shadow .2s, background-color .15s, border-color .15s; }
  .nb-btn--cta:hover{ background:var(--cta-600); border-color:var(--cta-600); color:#fff; transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.10); }

  /* Trays & headings */
  .nb-tray{ background:var(--shell); border-radius:18px; box-shadow:0 10px 28px rgba(0,0,0,.06); padding: clamp(18px,2vw,28px); margin: 10px auto 26px; }
  .nb-h2{ font-size: clamp(22px,3.2vw,32px); margin:0 0 12px; }
  .nb-h3{ font-size: clamp(18px,2.2vw,22px); margin:0 0 10px; }

  /* Cards / pills / steps */
  .nb-cards{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:14px; }
  @media (max-width: 680px){ .nb-cards{ grid-template-columns:1fr; } }
  .nb-card{ background:#fff; border-radius:14px; padding:16px 18px; box-shadow:0 12px 30px rgba(0,0,0,.05); }
  .nb-pills{ display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; list-style:none; padding:0; margin:0; }
  .nb-pill{ background:#fff; border-radius:9999px; padding:10px 14px; box-shadow:0 12px 30px rgba(0,0,0,.05); }
  .nb-steps{ list-style: decimal inside; padding-left:1rem; margin:0; }
  .nb-list{ padding-left:1.1rem; margin:0; }
  .nb-list li{ margin:.35rem 0; }

  /* Two-column grid */
  .nb-grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width: 860px){ .nb-grid-2{ grid-template-columns:1fr; } }
</style>
