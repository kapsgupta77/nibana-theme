{% comment %}
  Surge Signature™ Quiz (MVP)
  - Client-side quiz with soft gate and Mailchimp POST.
  - GA4 events: quiz_start, quiz_question_view, quiz_complete, quiz_result, email_submit.
{% endcomment %}
<section id="nb-quiz-{{ section.id }}" class="nb-quiz nb-quiz--surgesignature" data-section-id="{{ section.id }}" style="padding-block-start: clamp(80px, 10vw, 140px); padding-block-end: clamp(24px, 6vw, 72px); padding-inline: clamp(12px, 3vw, 24px);">
  <div class="nb-shell">
    <div class="nb-quiz__header nb-card">
      <h2 class="nb-quiz__title">{{ section.settings.title | escape }}</h2>
      <p class="nb-quiz__kicker">{{ section.settings.kicker | escape }}</p>
      {% if section.settings.intro_richtext != blank %}
        <div class="nb-quiz__intro rte">
          {{ section.settings.intro_richtext }}
        </div>
      {% endif %}
      <button class="nb-btn nb-btn--primary" data-nb-quiz-start>
        {{ section.settings.cta_label | default: 'Start the Quiz' }}
      </button>
      <p class="nb-quiz__trust">{{ section.settings.trust_microcopy }}</p>
    </div>
    <div class="nb-quiz__app" data-nb-quiz-app hidden></div>
    <div class="nb-quiz__result" data-nb-quiz-result hidden>
      <div class="nb-card nb-quiz__result-card">
        <div class="nb-quiz__result-copy" data-nb-quiz-form>
          <p class="nb-quiz__result-kicker">Your Surge Signature™</p>
          <h3 class="nb-quiz__result-title" data-nb-quiz-title></h3>
          <p class="nb-quiz__summary" data-nb-quiz-summary></p>
          <p class="nb-quiz__trust">We’ll email the full 2-page playbook with tailored practices. GDPR-friendly—no spam.</p>
          <div class="nb-quiz__free-insight" data-nb-quiz-practice></div>
        </div>

        <div id="nb-quiz-gate" class="nb-card nb-quiz__gate">
          <style>
            /* ---- scoped, only within this section ---- */
            #nb-quiz-shopify.nb-quiz__form { padding: 20px; }
            .nb-quiz__fieldset { display: grid; gap: 14px; }
            .nb-quiz__form .nb-field { display: grid; gap: 6px; }
            .nb-quiz__form label { font-size: 14px; line-height: 1.3; color: #1f2b33; }

            /* Inputs */
            .nb-quiz__form input[type="text"],
            .nb-quiz__form input[type="email"],
            .nb-quiz__form input[type="tel"]{
              width: 100%;
              padding: 14px 16px;
              border: 1px solid #dbe1e6;
              border-radius: 12px;
              background: #fff;
              box-shadow: 0 1px 0 rgba(15,23,42,.02);
              font-size: 16px;
            }

            /* Consent row: checkbox left, copy wraps nicely */
            .nb-quiz__consent{
              display: grid;
              grid-template-columns: 20px 1fr;
              align-items: start;
              gap: 10px;
              margin-top: 4px;
              color: #31424b;
              font-size: 14px;
              line-height: 1.45;
            }
            .nb-quiz__consent input[type="checkbox"]{ margin-top: 3px; }

            /* CTA — TEAL (not orange) */
            .nb-quiz__submit .nb-btn{
              width: 100%;
              padding: 14px 18px;
              border-radius: 14px;
              border: 1px solid transparent;
              background: #10636c;           /* Nibana teal */
              color: #fff;
              box-shadow: 0 6px 18px rgba(16,99,108,.16);
              font-weight: 600;
              font-size: 16px;
            }
            .nb-quiz__submit .nb-btn:hover{ background:#0b4f57; }

            /* Thank-you card */
            .nb-quiz__thanks{
              padding: 18px 20px;
              border-radius: 14px;
              background: rgba(16,99,108,.06);
              box-shadow: 0 1px 0 rgba(15,23,42,.02) inset;
            }
            .nb-quiz__thanks h3{ margin: 0 0 8px; }

            /* When we decide to show client fallback, hide the fieldset and show the client thanks */
            #nb-quiz-gate.is-client-thanks .nb-quiz__fieldset{ display:none; }
            #nb-quiz-gate.is-client-thanks #nb-quiz-client-thanks{ display:block; }
          </style>

          {% form 'customer', id: 'nb-quiz-shopify', class: 'nb-quiz__form', novalidate: 'novalidate' %}
            {% if form.posted_successfully? %}
              <div id="nb-quiz-server-thanks" class="nb-quiz__thanks">
                <h3>Check your inbox ✉️</h3>
                <p>We’ve sent your 2-page playbook. If it’s not there, check Promotions/Spam.</p>
                <p><a class="nb-link" href="/pages/surge-signature-result">View your result on Nibana →</a></p>
              </div>
            {% else %}
              <div class="nb-quiz__fieldset">
                <div class="nb-field">
                  <label for="nbq-fname">First name</label>
                  <input id="nbq-fname" name="contact[first_name]" type="text" required>
                </div>
                <div class="nb-field">
                  <label for="nbq-lname">Last name</label>
                  <input id="nbq-lname" name="contact[last_name]" type="text" required>
                </div>
                <div class="nb-field">
                  <label for="nbq-email">Email</label>
                  <input id="nbq-email" name="contact[email]" type="email" required>
                </div>
                <div class="nb-field">
                  <label for="nbq-phone">Phone (optional)</label>
                  <input id="nbq-phone" name="contact[phone]" type="tel">
                </div>

                <!-- hidden fields filled by JS just before submit -->
                <input type="hidden" id="nbq-tags" name="contact[tags]" value="">
                <input type="hidden" id="nbq-accepts" name="contact[accepts_marketing]" value="false">

                <div class="nb-quiz__consent">
                  <input id="nbq-consent" type="checkbox">
                  <label for="nbq-consent">Email me the 2-page playbook and follow-ups (unsubscribe anytime)</label>
                </div>

                <div class="nb-quiz__submit">
                  <button type="submit" class="nb-btn">Email me my playbook</button>
                </div>

                {% if form.errors %}
                  <div class="form__message" role="alert">{{ form.errors | default_errors }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endform %}

          <div id="nb-quiz-client-thanks" class="nb-quiz__thanks" style="display:none">
            <h3>Check your inbox ✉️</h3>
            <p>We’ve emailed your 2-page playbook. If it’s not there, check Promotions/Spam.</p>
            <p><a class="nb-link" href="/pages/surge-signature-result">View your result on Nibana →</a></p>
          </div>
        </div>

            <!-- Hidden Mailchimp mirror — submitted in parallel via JS -->
            <form action="https://life.us4.list-manage.com/subscribe/post?u=41960bde0a78c656a84bb759b&amp;id=d3d64ba831"
                  method="post" target="nbq-mc-target" id="nbq-mc" aria-hidden="true"
                  style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;">
              <input type="text"   name="FNAME" id="nbq-mc-fname">
              <input type="text"   name="LNAME" id="nbq-mc-lname">
              <input type="email"  name="EMAIL" id="nbq-mc-email">
              <input type="text"   name="PHONE" id="nbq-mc-phone">
              <!-- Lead Source group -->
              <input type="hidden" name="group[78632][1]" value="1">
              <!-- Style interests — we tick one via JS by setting checked=true -->
              <input type="checkbox" name="group[78632][2]" id="nbq-mc-acc" value="1">
              <input type="checkbox" name="group[78632][4]" id="nbq-mc-stab" value="1">
              <input type="checkbox" name="group[78632][8]" id="nbq-mc-def" value="1">
              <!-- Optional: STYLE merge field -->
              <input type="hidden" name="STYLE" id="nbq-mc-style">
              <input type="submit" value="Subscribe">
            </form>
            <iframe name="nbq-mc-target" id="nbq-mc-target" title="Mailchimp submit" hidden></iframe>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ 'nb-quiz-surgesignature.js' | asset_url }}" defer></script>
  <link rel="stylesheet" href="{{ 'nb-quiz-surgesignature.css' | asset_url }}" media="all">
  <script>
    window.NB_QUIZ = window.NB_QUIZ || {};
    window.NB_QUIZ['{{ section.id }}'] = {
      jsonUrl: {{ 'nb-quiz-surgesignature.json' | asset_url | json }},
      mailchimpAction: {{ section.settings.mailchimp_action | json }},
      enableGdpr: {{ section.settings.enable_gdpr | json }},
      gateMode: {{ section.settings.gate_mode | json }},
      palette: {{ section.settings.palette | json }},
      gaNamespace: 'surge_signature'
    };
  </script>

</section>

{% schema %}
{
  "name": "Surge Signature Quiz",
  "settings": [
    { "type": "text", "id": "title", "label": "Title", "default": "Meet your Surge Signature™" },
    { "type": "text", "id": "kicker", "label": "Subheading", "default": "Accelerator, Stabilizer, or Defuser? ~3 minutes." },
    { "type": "text", "id": "cta_label", "label": "Start button label", "default": "Start the Quiz" },
    { "type": "text", "id": "trust_microcopy", "label": "Trust microcopy", "default": "No fluff. Actionable results." },
    { "type": "text", "id": "mailchimp_action", "label": "Mailchimp action URL (…/subscribe/post?u=…&id=…)", "default": "https://life.us4.list-manage.com/subscribe/post?u=41960bde0a78c656a84bb759b&id=d3d64ba831" },
    { "type": "select", "id": "gate_mode", "label": "Gate mode", "default": "soft_gate",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "soft_gate", "label": "Soft gate on result" }
      ]
    },
    { "type": "checkbox", "id": "enable_gdpr", "label": "Show GDPR consent block", "default": true },
    { "type": "text", "id": "palette", "label": "Palette token (optional)", "default": "nibana" },
    { "type": "richtext",
      "id": "intro_richtext",
      "label": "Intro (short)",
      "default": "<p>15 quick questions to mirror how your energy moves when the stakes rise. You\u2019ll see your style with strengths, watch-outs, and a practice to try now; we\u2019ll email the full 2\u2011page playbook.</p>"
    }
  ],
  "blocks": [],
  "presets": [{ "name": "Surge Signature Quiz" }]
}
{% endschema %}
