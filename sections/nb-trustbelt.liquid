{% comment %}
Section: nb-trustbelt (reusable)
Wraps the global snippet `nb-trustbelt-core`.
Source can be:
  - Manual textarea (one item per line), or
  - A selected coaching_service metaobject's `social_proof` field.
{% endcomment %}

{% liquid
  assign _heading = section.settings.heading
  assign _source  = section.settings.source | default: 'text'
  assign _layout_choice = section.settings.layout | default: 'inherit'
  assign _speed   = section.settings.speed  | default: 22
  assign _pad_t   = section.settings.pad_top | default: 0
  assign _pad_b   = section.settings.pad_bottom | default: 0

  assign _items = nil
  assign _layout = 'belt'

  if _source == 'service_metaobject' and section.settings.service
    assign svc = section.settings.service

    assign sp_raw  = svc.social_proof | append: ''
    assign br_tag  = '<br class="nb-br">'
    assign sp_html = sp_raw | newline_to_br
    assign sp_norm = sp_html | replace: '<br/>', br_tag | replace: '<br>', br_tag
    assign sp_pipe = sp_norm | replace: br_tag, '|||'
    assign _items  = sp_pipe | split: '|||'

    if _layout_choice == 'inherit' and svc.social_proof_layout
      assign _layout = svc.social_proof_layout | downcase | strip
    else
      assign _layout = _layout_choice
    endif
  else
    assign _raw   = section.settings.items_text | to_string
    assign _items = _raw | split: '\n'

    if _layout_choice == 'inherit'
      assign _layout = 'belt'
    else
      assign _layout = _layout_choice
    endif
  endif
%}

{% style %}
  .nb-trustbelt-sec{ padding-block-start: {{ _pad_t }}px; padding-block-end: {{ _pad_b }}px; }
  .nb-trustbelt-sec__head{ margin: 0 0 clamp(6px,1.2vw,10px); text-align: center; }
{% endstyle %}

<section class="nb-trustbelt-sec">
  {% if _heading != blank %}
    <div class="nb-trustbelt-sec__head nb-shell">
      <h3 class="nb-h4">{{ _heading }}</h3>
    </div>
  {% endif %}

  {% render 'nb-trustbelt-core', items: _items, layout: _layout, speed: _speed %}
</section>

{% schema %}
{
  "name": "Trustbelt",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Trusted by" },

    { "type": "select", "id": "source", "label": "Source", "default": "text",
      "options": [
        { "value": "text", "label": "Manual (textarea)" },
        { "value": "service_metaobject", "label": "Service metaobject â†’ social_proof" }
      ]
    },

    { "type": "metaobject", "id": "service", "label": "Service (when using metaobject)", "metaobject_type": "coachingservice" },

    { "type": "select", "id": "layout", "label": "Layout", "default": "inherit",
      "options": [
        { "value": "inherit", "label": "Inherit from service (if set)" },
        { "value": "belt",    "label": "Belt (marquee)" },
        { "value": "grid",    "label": "Grid" }
      ]
    },

    { "type": "range","id": "speed","label": "Marquee speed (seconds, belt only)","min": 8, "max": 40, "step": 1, "default": 22 },

    { "type": "textarea", "id": "items_text", "label": "Items (one per line; used when Source = Manual)", "default": "Trusted by founders\nLoved by couples\nUsed by executives" },

    { "type": "header", "content": "Padding" },
    { "type": "range", "id": "pad_top",    "label": "Top (px)",    "min": 0, "max": 100, "step": 1, "default": 0 },
    { "type": "range", "id": "pad_bottom", "label": "Bottom (px)", "min": 0, "max": 100, "step": 1, "default": 0 }
  ],
  "presets": [
    { "name": "Trustbelt (Nibana)", "category": "Content" }
  ]
}
{% endschema %}
