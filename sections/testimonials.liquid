{% comment %}
  Nibana — Testimonials Section (blocks-based)
  - Tone controls soft tray background
  - Scroll-snap carousel, no JS required
  - Schema passes Shopify validation (no default on URL)
{% endcomment %}

<section class="nb-testimonials tone-{{ section.settings.tone }}">
  <div class="nb-testimonials__wrap">
    {% if section.settings.heading != blank %}
      <h2 class="nb-h2 nb-testimonials__title">{{ section.settings.heading }}</h2>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="nb-testimonials__scroller" aria-label="Client testimonials">
        <ul class="nb-testimonials__track">
          {% for block in section.blocks %}
            {% assign q = block.settings.quote | strip %}
            <li class="nb-testimonials__card" {{ block.shopify_attributes }}>
              {% if block.settings.avatar %}
                <figure class="nb-testimonials__avatar">
                  {{ block.settings.avatar | image_url: width: 160 | image_tag: class: 'nb-testimonials__avatar-img', alt: block.settings.title }}
                </figure>
              {% endif %}

              {% if section.settings.show_stars %}
                <div class="nb-testimonials__stars" aria-hidden="true" title="5 out of 5">
                  <span>★★★★★</span>
                </div>
              {% endif %}

              {% if q != blank %}
                <blockquote class="nb-testimonials__quote" style="--clamp: {{ section.settings.max_lines | default: 9 }}">
                  {{ q }}
                </blockquote>
              {% endif %}

              <div class="nb-testimonials__meta">
                <div class="nb-testimonials__name">{{ block.settings.title }}</div>
                {% if block.settings.location != blank %}
                  <div class="nb-testimonials__loc">{{ block.settings.location }}</div>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if section.settings.button_label != blank and section.settings.button_link != blank %}
      <div class="nb-testimonials__cta">
        <a class="nb-cta nb-cta--md" href="{{ section.settings.button_link }}">{{ section.settings.button_label }}</a>
      </div>
    {% endif %}
  </div>
</section>

{% stylesheet %}
/* ===== Testimonials (Nibana) ===== */
.nb-testimonials{
  --tray:#f4f7f6; --accent:#0F5B59;
  margin: clamp(14px, 3vw, 28px) 0;
}
.nb-testimonials.tone-sage   { --tray: #eaf4f3; --accent:#0F5B59; }
.nb-testimonials.tone-pebble { --tray: #fbf7f5; --accent:#B67955; }
.nb-testimonials.tone-ink    { --tray: #f6f9f8; --accent:#223238; }
.nb-testimonials.tone-white  { --tray: #ffffff; --accent: var(--nb-chocolate, #C86B2A); }

.nb-testimonials__wrap{
  background: var(--tray);
  border-radius: 22px;
  padding: clamp(16px, 2.8vw, 28px);
  box-shadow: 0 12px 32px rgba(0,0,0,.06);
}

.nb-testimonials__title{ margin:0 0 clamp(10px,1.6vw,16px); }

/* Scroller */
.nb-testimonials__scroller{ overflow:auto; -webkit-overflow-scrolling:touch; padding-bottom: 6px; }
.nb-testimonials__track{
  display:grid; grid-auto-flow: column;
  grid-auto-columns: minmax(280px, 38%);
  gap: clamp(10px,2vw,16px);
  scroll-snap-type: x mandatory; scroll-padding-left: 8px;
}
@media (max-width: 900px){
  .nb-testimonials__track{ grid-auto-columns: 84%; }
}

/* Card */
.nb-testimonials__card{
  scroll-snap-align: start;
  background:#fff; border:1px solid rgba(0,0,0,.06);
  border-radius:16px; padding: clamp(14px,1.8vw,18px);
  box-shadow:0 10px 20px rgba(0,0,0,.06);
  display:flex; flex-direction:column; gap:10px;
}

.nb-testimonials__avatar{ margin:0 }
.nb-testimonials__avatar-img{ width:48px; height:48px; border-radius:999px; object-fit:cover }

.nb-testimonials__stars{ color: var(--accent); font-size: 14px; letter-spacing:.2em }

.nb-testimonials__quote{
  margin:0; font-size: 1.02rem; line-height:1.55;
  display:-webkit-box; -webkit-line-clamp: var(--clamp, 9); -webkit-box-orient: vertical; overflow:hidden;
}

.nb-testimonials__meta{ margin-top:auto; }
.nb-testimonials__name{ font-weight:700; }
.nb-testimonials__loc{ color:#647078; font-size:.92rem }

.nb-testimonials__cta{ margin-top: clamp(10px, 2vw, 16px); text-align:center; }
{% endstylesheet %}

{% schema %}
{
  "name": "Testimonials",
  "presets": [
    { "name": "Testimonials" }
  ],
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What our clients say"
    },
    {
      "type": "select",
      "id": "tone",
      "label": "Tone",
      "default": "sage",
      "options": [
        { "value": "sage", "label": "Sage" },
        { "value": "pebble", "label": "Pebble" },
        { "value": "ink", "label": "Ink" },
        { "value": "white", "label": "White" }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_stars",
      "label": "Show star rating",
      "default": false
    },
    {
      "type": "range",
      "id": "max_lines",
      "label": "Max lines (quote clamp)",
      "min": 4,
      "max": 14,
      "step": 1,
      "default": 9
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "CTA label",
      "default": "Book a free 20-min call"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "CTA link"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "This work helped me get clear, make braver choices, and feel more alive in daily life."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Name / role",
          "default": "Client name"
        },
        {
          "type": "text",
          "id": "location",
          "label": "Location (optional)",
          "default": "London, UK"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Avatar (optional)"
        }
      ]
    }
  ]
}
{% endschema %}
