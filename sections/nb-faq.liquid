{% comment %}
  NB — Global FAQ section (Home-style pill look + single-open accordion)
  - Self-contained: HTML + CSS + JS in one file
  - Settings for width, tray/shell background, single-open logic, and colour overrides
{% endcomment %}

{%- assign c_ink   = section.settings.ink   | default: '#223238' -%}
{%- assign c_teal  = section.settings.teal  | default: '#0F5B59' -%}
{%- assign c_shell = section.settings.shell_col | default: '#E5E8E1' -%}
{%- assign c_ans   = section.settings.answer | default: '#EAF4F3' -%}
<link rel="stylesheet" href="{{ 'nb-faq.css' | asset_url }}">
<section
  id="nb-faq-{{ section.id }}"
  class="nb-faq style-home {% if section.settings.width == 'narrow' %}is-narrow{% elsif section.settings.width == 'wide' %}is-wide{% endif %}"
  style="--nb-ink: {{ c_ink }}; --nb-teal: {{ c_teal }}; --nb-shell: {{ c_shell }}; --nb-answer: {{ c_ans }};"
>
  <div class="nb-faq__inner {% unless section.settings.wrap_shell %}is-plain{% endunless %}">
    {% if section.settings.title != blank %}
      <h2 class="nb-faq__title">{{ section.settings.title }}</h2>
    {% endif %}

    <div class="nb-faq__list">
      {%- for block in section.blocks -%}
        <details class="nb-faq__item" {% if block.settings.open %}open{% endif %} {{ block.shopify_attributes }}>
          <summary class="nb-faq__q">
            {{ block.settings.q | escape }}
          </summary>
          <div class="nb-faq__a rte">
            {{ block.settings.a }}
          </div>
        </details>
      {%- endfor -%}
    </div>
  </div>

  <style>
    /* NIBANA — Global FAQ (Home-style pill variant) */
    :root{
      --nb-shadow-1: 0 12px 30px rgba(0,0,0,.06);
      --nb-shadow-2: 0 8px 22px rgba(0,0,0,.05);
    }
    .nb-faq{ padding: clamp(28px,3vw,60px) 0; background: transparent; }
    .nb-faq.has-full-panel{ background: var(--nb-shell) !important; }

    .nb-faq__inner{
      max-width: min(1160px, 94vw);
      margin-inline: auto;
      background: var(--nb-shell) !important;
      border-radius: 22px;
      box-shadow: var(--nb-shadow-1);
      padding: clamp(18px, 2.2vw, 28px);
    }
    .nb-faq__inner.is-plain{ background: transparent !important; box-shadow:none; padding:0; }

    .nb-faq.is-narrow .nb-faq__inner{ max-width: min(920px, 94vw); }
    .nb-faq.is-wide   .nb-faq__inner{ max-width: min(1320px,96vw); }

    /* Heading */
    .nb-faq.style-home .nb-faq__title{
      color: var(--nb-ink) !important;
      text-align: center;
      font-weight: 800;
      font-size: clamp(28px, 3.6vw, 40px);
      margin: 0 0 clamp(16px,2vw,22px);
    }

    .nb-faq__list{ display: grid; gap: 18px; }

    /* Base card (fallback) */
    .nb-faq__item{
      background: #fff;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.04);
      box-shadow: var(--nb-shadow-2);
      overflow: hidden;
    }
    .nb-faq__q{
      list-style: none;
      cursor: pointer;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 16px;
      padding: clamp(14px,1.6vw,18px) clamp(16px,2vw,22px);
      font-weight: 650;
      color: var(--nb-ink);
    }
    .nb-faq__q::-webkit-details-marker{ display:none; }
    .nb-faq__a{ padding: 0 clamp(16px,2vw,22px) clamp(16px,2vw,22px); line-height:1.6; color:#3a4a50; }
    .nb-faq__a ul{ padding-left:1.1rem; margin:.5rem 0 0; }
    .nb-faq__a li{ margin:.25rem 0; }

    /* HOME LOOK (dark-teal rounded pill + soft answer panel) */
    .nb-faq.style-home .nb-faq__item{
      background: transparent !important;
      border: 0 !important;
      box-shadow: none !important;
      overflow: visible;
    }
    .nb-faq.style-home .nb-faq__q{
      position: relative;
      background: var(--nb-teal) !important;
      color: #fff !important;
      border: 0 !important;
      border-radius: 9999px !important;
      padding: 16px 64px 16px 22px !important; /* extra right space for bubble */
      font-weight: 720 !important;
      box-shadow: 0 4px 14px rgba(0,0,0,.05);
    }
    /* hide any theme-provided icon */
    .nb-faq.style-home .nb-faq__q svg,
    .nb-faq.style-home .nb-faq__q .icon,
    .nb-faq.style-home .nb-faq__q .faq__icon{ display:none !important; }

    /* + / – bubble */
    .nb-faq.style-home .nb-faq__q::after{
      content: "+";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 38px; height: 38px;
      border-radius: 9999px;
      display: grid; place-items: center;
      color: #fff;
      background: rgba(255,255,255,.14);
      font-size: 22px; font-weight: 800; line-height:1;
    }
    .nb-faq.style-home .nb-faq__item[open] .nb-faq__q::after{ content: "–"; }

    /* hover tweak */
    .nb-faq.style-home .nb-faq__q:hover{
      background: color-mix(in srgb, var(--nb-teal) 92%, white) !important;
    }

    /* answer panel */
    .nb-faq.style-home .nb-faq__a{
      background: var(--nb-answer) !important;
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      margin: 10px 14px 2px !important;
      padding: 16px 20px !important;
      color: #2d4046 !important;
      line-height: 1.65;
      box-shadow: 0 1px 0 rgba(255,255,255,.4) inset;
    }

    /* focus ring */
    .nb-faq.style-home .nb-faq__q:focus{
      outline: 3px solid rgba(15,91,89,.35);
      outline-offset: 2px;
      border-radius: 9999px;
    }
  </style>

  {% if section.settings.single_open %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const root = document.getElementById('nb-faq-{{ section.id }}');
      if (!root) return;
      // keep exactly one open within this section
      root.addEventListener('toggle', function (ev) {
        const d = ev.target;
        if (d.tagName !== 'DETAILS' || !d.open) return;
        root.querySelectorAll('details[open]').forEach(other => {
          if (other !== d) other.open = false;
        });
      }, true);
    });
  </script>
  {% endif %}
</section>

{% schema %}
{
  "name": "NB — FAQ (Global)",
  "tag": "section",
  "class": "section nb-faq-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Frequently asked questions"
    },
    {
      "type": "select",
      "id": "width",
      "label": "Content width",
      "default": "normal",
      "options": [
        { "value": "narrow", "label": "Narrow" },
        { "value": "normal", "label": "Normal" },
        { "value": "wide",   "label": "Wide" }
      ]
    },
    {
      "type": "checkbox",
      "id": "wrap_shell",
      "label": "Wrap in soft tray background",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "single_open",
      "label": "Only one item open at a time",
      "default": true
    },

    { "type": "header", "content": "Colours (optional overrides)" },
    {
      "type": "color",
      "id": "ink",
      "label": "Ink (text)",
      "default": "#223238"
    },
    {
      "type": "color",
      "id": "teal",
      "label": "Teal (pill)",
      "default": "#0F5B59"
    },
    {
      "type": "color",
      "id": "shell_col",
      "label": "Tray / shell background",
      "default": "#E5E8E1"
    },
    {
      "type": "color",
      "id": "answer",
      "label": "Answer background",
      "default": "#EAF4F3"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "FAQ item",
      "settings": [
        {
          "type": "text",
          "id": "q",
          "label": "Question",
          "default": "Your question here"
        },
        {
          "type": "richtext",
          "id": "a",
          "label": "Answer",
          "default": "<p>Your answer text goes here.</p>"
        },
        {
          "type": "checkbox",
          "id": "open",
          "label": "Open by default",
          "default": false
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "NB — FAQ (Global)",
      "category": "Text",
      "blocks": [
        { "type": "item", "settings": { "q": "What’s included?", "a": "<p>Answer example.</p>" } },
        { "type": "item", "settings": { "q": "How long is the call?", "a": "<p>Answer example.</p>" } }
      ]
    }
  ]
}
{% endschema %}