{% comment %} Lead-magnet redirect section (editor-safe) {% endcomment %}
<section id="nb-redirect-{{ section.id }}" class="nb-redirect">
  {% assign target = section.settings.target_url | strip %}

  {% if request.design_mode %}
    <div class="nb-shell" style="max-width: 760px; margin: 24px auto;">
      <div class="nb-home-contact__panel" style="padding: 20px;">
        <h2 style="margin:0 0 8px;">Redirect preview</h2>
        {% if target != blank %}
          <p style="margin:0 0 12px;">This page will automatically redirect on the live site.</p>
          <p style="margin:0 0 12px;"><strong>Target URL:</strong><br>
            <a href="{{ target }}" target="_blank" rel="noopener">{{ target }}</a>
          </p>
          <p style="margin:0;">Auto-redirect is disabled in the Theme Editor so you can configure this section.</p>
        {% else %}
          <p style="margin:0;">Add a Target URL in the section settings to enable the redirect.</p>
        {% endif %}
      </div>
    </div>
  {% else %}
    {% if target != blank %}
      <div class="nb-shell" style="max-width: 760px; margin: 24px auto;">
        <div class="nb-home-contact__panel" style="padding: 20px;">
          <p>Opening your guideâ€¦</p>
          <p><a href="{{ target }}">Click here if you are not redirected.</a></p>
        </div>
      </div>

      <script>
      (function () {
        var url = {{ target | json }};
        if (!url) return;
        try {
          if (typeof gtag === 'function') {
            gtag('event', 'asset_open', { asset: 'connection_guide', method: 'redirect' });
          }
        } catch (e) {}
        try { window.location.replace(url); } catch (e) { window.location.href = url; }
      })();
      </script>
      <noscript><meta http-equiv="refresh" content="0; url={{ target | escape }}"></noscript>
    {% else %}
      <div class="nb-shell" style="max-width: 760px; margin: 24px auto;">
        <div class="nb-home-contact__panel" style="padding: 20px;">
          <p>No target URL set.</p>
        </div>
      </div>
    {% endif %}
  {% endif %}
</section>

{% schema %}
{
  "name": "LM Redirect",
  "settings": [
    { "type": "text", "id": "target_url", "label": "Target URL" },
    { "type": "checkbox", "id": "noindex", "label": "Noindex this page", "default": true }
  ]
}
{% endschema %}

{% stylesheet %}
{% if section.settings.noindex %}
<meta name="robots" content="noindex,follow">
{% endif %}
{% endstylesheet %}
